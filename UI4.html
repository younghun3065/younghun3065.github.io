<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stroke Rehab Watch UI (Final Fixed)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        body {
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* 1. ì‹œê³„ ì¼€ì´ìŠ¤ (ë² ì ¤) */
        .watch-case {
            width: 360px;
            height: 440px;
            background-color: #1c1c1e;
            border-radius: 48px;
            /* ë‚´ë¶€ ì—¬ë°±ì´ í™”ë©´ í¬ê¸°ë¥¼ ì¹¨ë²”í•˜ì§€ ì•Šë„ë¡ ì„¤ì • */
            padding: 12px; 
            box-sizing: border-box; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
            border: 4px solid #3a3a3c;
            /* í™”ë©´ì´ íŠ€ì–´ë‚˜ì˜¤ì§€ ì•Šê²Œ í•˜ëŠ” í•µì‹¬ ì†ì„± */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 2. ë‚´ë¶€ ìŠ¤í¬ë¦° (í™”ë©´) */
        .screen {
            width: 100%;
            height: 100%;
            background-color: #000;
            border-radius: 36px; /* ë² ì ¤ ê³¡ë¥ ì— ë§ì¶¤ */
            /* í™”ë©´ ë°–ìœ¼ë¡œ íŠ€ì–´ë‚˜ê°€ëŠ” ìš”ì†Œ ìˆ¨ê¹€ (ê°€ì¥ ì¤‘ìš”) */
            overflow: hidden; 
            color: white;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ìƒë‹¨ ìƒíƒœë°” */
        .status-bar {
            padding: 10px 20px;
            font-size: 12px;
            color: #8e8e93;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }

        /* ì½˜í…ì¸  ì˜ì—­ ê³µí†µ */
        .content {
            flex: 1;
            padding: 10px;
            text-align: center;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .content.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- ì¸¡ì • ì¤‘ í™”ë©´ ìŠ¤íƒ€ì¼ --- */
        #measuring-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: #000;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .pulse-circle {
            width: 60px; height: 60px;
            background-color: #0a84ff;
            border-radius: 50%;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }

        /* --- ê²½ê³  í™”ë©´ ìŠ¤íƒ€ì¼ --- */
        #alert-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 69, 58, 0.95); /* ê°•í•œ ë¹¨ê°• ë°°ê²½ */
            z-index: 100;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .alert-icon { font-size: 60px; margin-bottom: 15px; }
        .alert-title { font-size: 26px; font-weight: bold; margin-bottom: 10px; }
        .alert-btn {
            background: white; color: #ff453a; border: none; padding: 12px 30px;
            border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 20px;
        }

        /* ê²Œì´ì§€ & í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .gauge-container { position: relative; width: 180px; height: 180px; margin-bottom: 20px; }
        .value-display { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 100%; }
        .value-number { font-size: 42px; font-weight: 700; line-height: 1; }
        .value-label { font-size: 14px; color: #8e8e93; margin-top: 5px; }
        .unbalanced-arm { font-size: 18px; font-weight: bold; margin-top: 5px; }

        .status-msg { font-size: 16px; font-weight: 600; margin-top: 10px; padding: 8px 16px; border-radius: 20px; }
        .msg-danger { background-color: rgba(255, 69, 58, 0.2); color: #ff453a; }
        .msg-warning { background-color: rgba(255, 159, 10, 0.2); color: #ff9f0a; } 
        .msg-safe { background-color: rgba(48, 209, 88, 0.2); color: #30d158; }

        /* íƒ­ ë° ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        #tab-trend.content, #tab-calendar.content { justify-content: flex-start; padding-top: 20px; }
        .chart-wrapper { width: 100%; height: 200px; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; width: 100%; max-width: 320px; }
        .day-label { font-size: 12px; color: #8e8e93; }
        .day-cell { padding: 8px 0; font-size: 16px; border-radius: 50%; cursor: pointer; }
        .day-cell.has-data { border: 1px solid #0a84ff; color: #0a84ff; }
        .day-cell.active-date { background-color: #0a84ff; color: white; }
        .day-cell.disabled { color: #444; cursor: default; }

        .tab-bar {
            height: 60px; display: flex; justify-content: space-around; align-items: center;
            background-color: #1c1c1e; border-top: 1px solid #2c2c2e; width: 100%;
        }
        .tab-btn { background: none; border: none; color: #8e8e93; font-size: 24px; cursor: pointer; padding: 10px; }
        .tab-btn.active { color: #0a84ff; }
    </style>
</head>
<body>

    <div class="watch-case">
        <div class="crown" style="position: absolute; right: -12px; top: 100px; width: 12px; height: 40px; background: #48484a; border-radius: 0 6px 6px 0;"></div>
        <div class="side-button" style="position: absolute; right: -12px; top: 160px; width: 6px; height: 80px; background: #48484a; border-radius: 0 4px 4px 0;"></div>
        
        <div class="screen">
            <div id="measuring-screen">
                <div class="pulse-circle"></div>
                <h3 style="margin: 0;">ì¸¡ì • ì¤‘...</h3>
                <p style="color: #8e8e93; font-size: 14px;">ì„¼ì„œ ë°ì´í„° ë¶„ì„</p>
            </div>

            <div id="alert-screen">
                <div class="alert-icon">âš ï¸</div>
                <div class="alert-title">ê²½ê³ !</div>
                <p style="font-size: 16px; margin-bottom: 20px;">
                    ì‹¬ê°í•œ í™œë™ëŸ‰ ë¶ˆê· í˜•ì´<br>ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
                </p>
                <button class="alert-btn" onclick="closeAlert()">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
            </div>

            <div class="status-bar">
                <span>09:41</span>
                <span id="current-day-label">1ì›” 14ì¼</span>
            </div>

            <div id="tab-home" class="content">
                <div class="gauge-container">
                    <canvas id="gaugeChart"></canvas>
                    <div class="value-display">
                        <div class="value-number" id="current-uratio">--</div>
                        <div class="value-label">Usage Ratio</div>
                        <div class="unbalanced-arm" id="unbalanced-arm-display">--</div>
                    </div>
                </div>
                <div class="status-msg" id="status-text">ìƒíƒœ í™•ì¸ ì¤‘</div>
            </div>

            <div id="tab-trend" class="content">
                <p style="font-size: 12px; color: #8e8e93; margin-bottom: 5px;">ë‚ ì§œë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="chart-wrapper">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <div id="tab-calendar" class="content">
                <h3 style="margin-bottom: 10px;">2025ë…„ 1ì›”</h3>
                <div id="calendar-grid" class="calendar-grid">
                    <div class="day-label">ì¼</div><div class="day-label">ì›”</div><div class="day-label">í™”</div>
                    <div class="day-label">ìˆ˜</div><div class="day-label">ëª©</div><div class="day-label">ê¸ˆ</div><div class="day-label">í† </div>
                </div>
            </div>

            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchTab('home')">ğŸ </button>
                <button class="tab-btn" onclick="switchTab('trend')">ğŸ“ˆ</button>
                <button class="tab-btn" onclick="switchTab('calendar')">ğŸ“…</button>
            </div>
        </div>
    </div>

    <script>
        // --- ë°ì´í„° ì„¤ì • (Right/Left -> ì˜¤ë¥¸/ì™¼ ìˆ˜ì • ì™„ë£Œ) ---
        const DAYS_IN_SIMULATION = 14;
        const SIM_START_DAY = new Date('2025-01-01');

        const simulationData = [
            { day: 1, uRatio: 0.52, lessUsedArm: 'None' }, 
            { day: 2, uRatio: 0.50, lessUsedArm: 'None' }, 
            { day: 3, uRatio: 0.51, lessUsedArm: 'None' }, 
            { day: 4, uRatio: 0.47, lessUsedArm: 'ì˜¤ë¥¸' }, 
            { day: 5, uRatio: 0.44, lessUsedArm: 'ì˜¤ë¥¸' }, 
            { day: 6, uRatio: 0.53, lessUsedArm: 'None' }, 
            { day: 7, uRatio: 0.50, lessUsedArm: 'None' }, 
            { day: 8, uRatio: 0.49, lessUsedArm: 'ì™¼' }, 
            { day: 9, uRatio: 0.51, lessUsedArm: 'None' }, 
            { day: 10, uRatio: 0.47, lessUsedArm: 'ì™¼' }, 
            { day: 11, uRatio: 0.43, lessUsedArm: 'ì™¼' }, 
            { day: 12, uRatio: 0.48, lessUsedArm: 'ì˜¤ë¥¸' }, 
            { day: 13, uRatio: 0.45, lessUsedArm: 'ì˜¤ë¥¸' }, 
            { day: 14, uRatio: 0.42, lessUsedArm: 'ì˜¤ë¥¸' }  
        ];

        const uRatios = simulationData.map(d => d.uRatio);
        const barColors = uRatios.map(r => r < 0.45 ? '#ff453a' : (r < 0.50 ? '#ff9f0a' : '#30d158'));

        let gaugeChart, trendChart;
        let activeDayIndex = simulationData.length - 1; 

        // --- ì´ˆê¸°í™” ë¡œì§ (ì¸¡ì • ì¤‘ í™”ë©´ í¬í•¨) ---
        window.onload = function() {
            // 1. 3ì´ˆê°„ ì¸¡ì • ì¤‘ í™”ë©´ ë³´ì—¬ì£¼ê¸°
            setTimeout(() => {
                document.getElementById('measuring-screen').style.display = 'none'; // ì¸¡ì • í™”ë©´ ìˆ¨ê¹€
                document.getElementById('tab-home').classList.add('active'); // í™ˆ í™”ë©´ í™œì„±í™”
                
                // 2. ì°¨íŠ¸ ë° ë°ì´í„° ë¡œë“œ
                initCharts();
                generateCalendar(SIM_START_DAY);
                updateHomeView(activeDayIndex); 

            }, 3000); // 3000ms = 3ì´ˆ
        };

        function initCharts() {
            // ë©”ì¸ ê²Œì´ì§€
            const ctxGauge = document.getElementById('gaugeChart').getContext('2d');
            gaugeChart = new Chart(ctxGauge, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0.5, 0.5], 
                        backgroundColor: ['#333', '#333'],
                        borderWidth: 0,
                        circumference: 360,
                        rotation: 270,
                        cutout: '85%'
                    }]
                },
                options: { plugins: { legend: { display: false }, tooltip: { enabled: false } }, responsive: true, maintainAspectRatio: false }
            });

            // íŠ¸ë Œë“œ ì°¨íŠ¸
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            if (ctxTrend) {
                trendChart = new Chart(ctxTrend, {
                    type: 'bar',
                    data: {
                        labels: simulationData.map(d => d.day),
                        datasets: [{ label: 'Ratio', data: uRatios, backgroundColor: barColors, borderRadius: 3 }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        onClick: (e) => {
                            const points = trendChart.getElementsAtEventForMode(e, 'nearest', { intersect: true }, false);
                            if (points.length) {
                                updateHomeView(points[0].index);
                                switchTab('home');
                            }
                        },
                        plugins: { legend: { display: false }, annotation: { annotations: { line1: { type: 'line', yMin: 0.45, yMax: 0.45, borderColor: 'white', borderDash: [5,5], borderWidth: 1 } } } },
                        scales: { x: { grid: { display: false }, ticks: { color: '#888' } }, y: { min: 0.3, max: 0.6, grid: { color: '#333' } } }
                    }
                });
            }
        }

        // --- í™”ë©´ ì—…ë°ì´íŠ¸ (ê²½ê³ ì°½ ë¡œì§ í¬í•¨) ---
        function updateHomeView(index) {
            activeDayIndex = index;
            const data = simulationData[index];
            const ratio = data.uRatio;
            const arm = data.lessUsedArm;
            const color = ratio < 0.45 ? '#ff453a' : (ratio < 0.50 ? '#ff9f0a' : '#30d158');
            
            // ë‚ ì§œ ê³„ì‚°
            const date = new Date(SIM_START_DAY);
            date.setDate(date.getDate() + index);
            document.getElementById('current-day-label').textContent = `${date.getMonth()+1}ì›” ${date.getDate()}ì¼`;

            // ê°’ ì—…ë°ì´íŠ¸
            document.getElementById('current-uratio').textContent = ratio.toFixed(2);
            const armEl = document.getElementById('unbalanced-arm-display');
            const statusEl = document.getElementById('status-text');

            // ìƒíƒœ í´ë˜ìŠ¤ ì´ˆê¸°í™”
            statusEl.className = 'status-msg';
            armEl.style.color = '#fff';

            // ê²½ê³ ì°½ ì´ˆê¸°í™” (ìˆ¨ê¹€)
            closeAlert();

            if (ratio < 0.45) {
                // ì‹¬ê° (ë¹¨ê°•)
                statusEl.textContent = "ì„ê³„ê°’ ì´íƒˆ (ì‹¬ê°í•œ ë¶ˆê· í˜•)";
                statusEl.classList.add('msg-danger');
                armEl.textContent = `${arm}íŒ” ë¹„ì‚¬ìš© ì‹¬í™”`;
                armEl.style.color = '#ff453a';
                
                // ê²½ê³  íŒì—… ë„ìš°ê¸° (ë°ì´í„° ë¡œë“œ ì§í›„ ë°”ë¡œ ëœ¸)
                document.getElementById('alert-screen').style.display = 'flex';

            } else if (ratio < 0.50) {
                // ì£¼ì˜ (ì£¼í™©)
                statusEl.textContent = "ì¡°ê¸° íƒì§€ (ê°ì†Œ ì¶”ì„¸ ê°ì§€)";
                statusEl.classList.add('msg-warning');
                armEl.textContent = `${arm}íŒ” ì‚¬ìš©ëŸ‰ ì£¼ì˜`;
                armEl.style.color = '#ff9f0a';
            } else {
                // ì •ìƒ (ì´ˆë¡)
                statusEl.textContent = "ì–‘íŒ” ì‚¬ìš© ê· í˜• ì •ìƒ";
                statusEl.classList.add('msg-safe');
                armEl.textContent = "ì–‘íŒ” í™œë™ëŸ‰ ê· í˜•";
                armEl.style.color = '#30d158';
            }

            // ê²Œì´ì§€ ì—…ë°ì´íŠ¸
            gaugeChart.data.datasets[0].data = [ratio, 1 - ratio];
            gaugeChart.data.datasets[0].backgroundColor = [color, '#333'];
            gaugeChart.update();
        }

        function generateCalendar(startDate) {
            const grid = document.getElementById('calendar-grid');
            // ê¸°ì¡´ ì…€ ì œê±° í›„ ì¬ìƒì„± ë°©ì§€ ë¡œì§ í•„ìš”ì‹œ ì¶”ê°€. ì—¬ê¸°ì„  ê°„ë‹¨íˆ ë®ì–´ì”€.
            // grid.innerHTML = '...header labels...'; (í—¤ë”ëŠ” HTMLì— ê³ ì •)
            
            // ê·¸ë¦¬ë“œ ë‚´ìš© ì´ˆê¸°í™” (í—¤ë” ì œì™¸í•˜ê³  ì…€ë§Œ ì¶”ê°€í•˜ë ¤ë©´ ë¡œì§ ë³€ê²½ í•„ìš”í•˜ì§€ë§Œ, ì—¬ê¸°ì„  ê°„ë‹¨íˆ ë’¤ì— append)
            // í¸ì˜ìƒ HTML êµ¬ì¡° ìœ ì§€í•˜ê³  ë‚ ì§œ ì…€ë§Œ ë™ì  ìƒì„±
            
            const startDay = startDate.getDay(); 
            for(let i=0; i<startDay; i++) {
                let d = document.createElement('div'); d.className='day-cell disabled'; grid.appendChild(d);
            }
            for(let d=1; d<=31; d++) {
                let cell = document.createElement('div'); 
                cell.className = 'day-cell'; 
                cell.textContent = d;
                if(d <= DAYS_IN_SIMULATION) {
                    cell.classList.add('has-data');
                    let idx = d-1;
                    cell.onclick = () => { updateHomeView(idx); switchTab('home'); };
                } else {
                    cell.classList.add('disabled');
                }
                grid.appendChild(cell);
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-'+tab).classList.add('active');
            // ë²„íŠ¼ í™œì„±í™”ëŠ” ìˆœì„œëŒ€ë¡œ (0:í™ˆ, 1:íŠ¸ë Œë“œ, 2:ìº˜ë¦°ë”)
            const btnIdx = tab === 'home' ? 0 : (tab === 'trend' ? 1 : 2);
            document.querySelectorAll('.tab-btn')[btnIdx].classList.add('active');

            if(tab === 'trend' && trendChart) trendChart.resize();
        }

        function closeAlert() {
            document.getElementById('alert-screen').style.display = 'none';
        }

    </script>
</body>
</html>